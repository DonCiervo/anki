<div class="container {{Tags}} {{Deck}}">

  <div class="box">

    <fieldset class="box_title">
      <legend></legend>
      {{Front}}
    </fieldset>

    <div class="box_text">
    {{#Answer}}<div>{{Answer}}</div><br>{{/Answer}}

        <!-- If no Image, keep showing preview, if there is one -->
        {{#Postview}}<div style="display: none">{{/Postview}}
            {{#Preview}}<div id="previewWrap" class="image_text">{{Preview}}</div>{{/Preview}}
        {{#Postview}}</div>{{/Postview}}

        {{#Postview}}<div id="postviewWrap" class="image_text">{{Postview}}</div>{{/Postview}}

    {{#Description}}<div>{{Description}}</div>{{/Description}}
    </div>

  </div>

  <div class="ctag">
    <div class="css"></div>
    <div class="html"></div>
    <div class="ts"></div>
    <div class="js"></div>
    <div class="py"></div>
    <div class="c"></div>
    <div class="r"></div>
    <div class="sql"></div>
    <div class="jayvee"></div>
    <div class="go"></div>
  </div>

  <div class="roundtag">
    <div class="subdeck">{{Subdeck}}</div>
    <div class="subject"></div>
  </div>

  {{#Questions}}<div class="annotation questions">{{Questions}}</div>{{/Questions}}
  {{#Notes}}<div class="annotation notes">{{Notes}}</div>{{/Notes}}

</div>


<script> /*------------------------ ADJUST CODE WIDTH ------------------*/
function adjustTableFontSize() {
  const tables = document.querySelectorAll('.highlighttable');

  tables.forEach(table => {
    const parentWidth = table.parentElement.offsetWidth;
    const tableWidth = table.offsetWidth;
    const fontSize = parseFloat(window.getComputedStyle(table).fontSize);
    const padding = parseFloat(window.getComputedStyle(table).paddingLeft) + parseFloat(window.getComputedStyle(table).paddingRight);

    if (tableWidth + padding > parentWidth) {
      const newFontSize = fontSize * ((parentWidth - padding) / tableWidth);
      table.style.fontSize = newFontSize + 'px';
    }
  });
}

// Adjust table font size on window resize and page load
window.addEventListener('resize', adjustTableFontSize);
adjustTableFontSize();
</script>


<script> /*------------------------ Replace Arrow Symbols --------------*/
(function () {
  const replacements = {
    "-->": "➜",
    "<-->": "⟷",
  };

  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);

  let node;
  while ((node = walker.nextNode())) {
    let text = node.nodeValue;
    if (!text) continue;

    // skip nodes that contain none of the keys
    let changed = false;

    // replace longer patterns first to avoid conflicts
    for (const from of Object.keys(replacements).sort((a, b) => b.length - a.length)) {
      if (text.includes(from)) {
        text = text.split(from).join(replacements[from]);
        changed = true;
      }
    }

    if (changed) node.nodeValue = text;
  }
})();
</script>

<script> /*------------------------ ADJUST TITLE SIZE ------------------*/
function adjustBoxTitleFontSize() {
  const el = document.querySelector('.box_title');
  if (!el) return;

  const len = (el.textContent || '').replace(/\s+/g, ' ').trim().length;
  if (len > 150) {
    el.style.fontSize = '100%';
    el.style.padding = '10px';
  }
}
adjustBoxTitleFontSize();
</script>


<script> /*------------------------ Randomize Multiple Choice Qs -------*/
(function () {
  const KEY = "ul_shuffle_order_v1";


  function applyOrder(ul, order) {
    const items = Array.from(ul.children);
    if (order.length !== items.length) return false;

    ul.innerHTML = "";
    order.forEach(i => ul.appendChild(items[i]));
    return true;
  }

  function shuffleAndStore(ul) {
    const items = Array.from(ul.children);
    const order = items.map((_, i) => i);

    for (let i = order.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [order[i], order[j]] = [order[j], order[i]];
    }

    ul.innerHTML = "";
    order.forEach(i => ul.appendChild(items[i]));
    sessionStorage.setItem(KEY, JSON.stringify(order));
  }

  function waitForTargetUl() {
    const wrap = postviewWrap || previewWrap;
    const ul = wrap ? wrap.querySelector("ul") : null;

    if (!ul) {
      requestAnimationFrame(waitForTargetUl);
      return;
    }

    const stored = sessionStorage.getItem(KEY);
    if (stored) {
      try {
        const order = JSON.parse(stored);
        if (applyOrder(ul, order)) {
          sessionStorage.removeItem(KEY);
          return;
        }
      } catch (e) {}
    }

    // Fallback: if storage missing or mismatch
    shuffleAndStore(ul);
  }

  waitForTargetUl();
})();
</script>
